<section class="widget widget-archives card">
    <div class="card-content">
        <div class="widget-title">
            <span>归档</span>
        </div>
        
        <ul class="widget-archive--list">
            {{- /* 【修复说明】
                1. 使用全局函数 site.RegularPages，不再依赖 .Context，防止报错。
                2. 先把文章筛选出来存到变量 $posts 里，确保逻辑清晰。
                3. 只选取 Type 为 "post" 的文章，排除关于页、友链等。
            */ -}}
            {{- $posts := where site.RegularPages "Type" "post" -}}
            
            {{- range $posts.GroupByDate "2006" -}}
            <li class="widget-archive--item">
                <a href="/archives/#{{ .Key }}" title="{{ .Key }}">
                    <span>{{ .Key }}</span>
                    <span class="widget-archive--count">{{ len .Pages }}</span>
                </a>
            </li>
            {{- end -}}
        </ul>
    </div>
</section>